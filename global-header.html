<style>
  .global-header {
    width: 100%;
    height: {{property.headerHeight}}px;
    {{#if (eq property.headerBgType 'gradient')}}
    background: linear-gradient({{property.headerGradientAngle}}deg, {{property.headerGradientStart}}, {{property.headerGradientEnd}});
    {{else}}
    background: {{property.headerBg}};
    {{/if}}
    {{#if (gt property.headerShadow 0)}}
    box-shadow: 0 2px {{property.headerShadow}}px {{property.headerShadowColor}};
    {{/if}}
    {{#if (gt property.headerBlur 0)}}
    backdrop-filter: blur({{property.headerBlur}}px);
    -webkit-backdrop-filter: blur({{property.headerBlur}}px);
    {{/if}}
    {{#if (gt property.headerBorder 0)}}
    border-bottom: {{property.headerBorder}}px solid {{property.headerBorderColor}};
    {{/if}}
    transition: all 0.3s ease;
    z-index: 1000;

    {{#if property.isOverlay}}
    position: {{#if property.isSticky}}fixed{{else}}absolute{{/if}};
    top: 0;
    left: 0;
    {{else}}
      {{#if property.isSticky}}
      position: sticky;
      top: 0;
      {{else}}
      position: relative;
      {{/if}}
    {{/if}}
  }

  {{#if property.enableScrollStyle}}
  .global-header.scrolled {
    {{#if (eq property.scrollBgType 'gradient')}}
    background: linear-gradient({{property.scrollGradientAngle}}deg, {{property.scrollGradientStart}}, {{property.scrollGradientEnd}}) !important;
    {{else}}
    background: {{property.scrollBg}} !important;
    {{/if}}
    {{#if (gt property.scrollShadow 0)}}
    box-shadow: 0 2px {{property.scrollShadow}}px {{property.scrollShadowColor}} !important;
    {{else}}
    box-shadow: none !important;
    {{/if}}
    {{#if (gt property.scrollBlur 0)}}
    backdrop-filter: blur({{property.scrollBlur}}px) !important;
    -webkit-backdrop-filter: blur({{property.scrollBlur}}px) !important;
    {{/if}}
  }
  {{/if}}

  .header-container {
    {{#if property.containerMaxWidthEnabled}}
    max-width: {{property.containerMaxWidth}}px;
    margin: 0 auto;
    padding: 0 {{property.containerPaddingDesktop}}px;
    {{else}}
    max-width: 100%;
    padding: 0 {{property.headerPadding}}px;
    {{/if}}
    height: 100%;
    display: grid;
    grid-template-columns: 1fr auto 1fr;
    align-items: center;
    gap: 20px;
  }

  .header-left {
    display: flex;
    {{#if (eq property.logoAlign 'left')}}
    justify-content: flex-start;
    {{else if (eq property.logoAlign 'center')}}
    justify-content: center;
    {{else}}
    justify-content: flex-end;
    {{/if}}
  }

  .header-center {
    display: flex;
    justify-content: center;
  }

  .header-right {
    display: flex;
    align-items: center;
    gap: 20px;
    {{#if (eq property.menuAlign 'left')}}
    justify-content: flex-start;
    {{else if (eq property.menuAlign 'center')}}
    justify-content: center;
    {{else}}
    justify-content: flex-end;
    {{/if}}
  }

  .header-right-content {
    display: flex;
    align-items: center;
    gap: 20px;
    margin-right: {{property.headerRightMargin}}px;
  }

  .logo {
    display: flex;
    align-items: center;
    margin: {{property.logoMarginY}}px {{property.logoMarginX}}px;
  }

  .logo a {
    display: block;
    line-height: 0;
  }

  {{#if property.logoImage}}
  .logo img {
    width: {{property.logoWidth}}px;
    height: auto;
  }
  {{/if}}

  .nav-desktop {
    display: flex;
    gap: {{property.menuGapDesktop}}px;
    align-items: center;
    margin: {{property.menuMarginY}}px {{property.menuMarginX}}px;
  }

  .nav-desktop a {
    color: {{property.menuColorDesktop}};
    font-size: {{property.menuSizeDesktop}}px;
    text-decoration: none;
    white-space: nowrap;
    {{#if (eq property.menuHoverEffect 'opacity')}}
    transition: opacity 0.2s;
    {{else if (eq property.menuHoverEffect 'color')}}
    transition: color 0.2s;
    {{else if (eq property.menuHoverEffect 'scale')}}
    transition: transform 0.2s;
    {{else}}
    transition: all 0.2s;
    {{/if}}
  }

  .nav-desktop a:hover {
    {{#if (eq property.menuHoverEffect 'opacity')}}
    opacity: 0.6;
    {{else if (eq property.menuHoverEffect 'color')}}
    color: {{property.menuHoverColor}};
    {{else if (eq property.menuHoverEffect 'underline')}}
    text-decoration: underline;
    {{else if (eq property.menuHoverEffect 'scale')}}
    transform: scale(1.05);
    {{/if}}
  }

  .utility-menu {
    display: flex;
    gap: {{property.utilityMenuGap}}px;
    align-items: center;
  }

  .utility-item {
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .utility-item svg {
    width: {{property.utilityIconSize}}px;
    height: {{property.utilityIconSize}}px;
  }

  .utility-item svg * {
    stroke: {{property.utilityIconColor}};
    fill: {{property.utilityIconColor}};
  }

  .utility-menu a {
    color: {{property.utilityMenuColor}};
    font-size: {{property.utilityMenuSize}}px;
    text-decoration: none;
    {{#if (eq property.utilityMenuHoverEffect 'opacity')}}
    transition: opacity 0.2s;
    {{else if (eq property.utilityMenuHoverEffect 'color')}}
    transition: color 0.2s;
    {{else if (eq property.utilityMenuHoverEffect 'scale')}}
    transition: transform 0.2s;
    {{else}}
    transition: all 0.2s;
    {{/if}}
  }

  .utility-menu a:hover {
    {{#if (eq property.utilityMenuHoverEffect 'opacity')}}
    opacity: 0.6;
    {{else if (eq property.utilityMenuHoverEffect 'color')}}
    color: {{property.utilityMenuHoverColor}};
    {{else if (eq property.utilityMenuHoverEffect 'underline')}}
    text-decoration: underline;
    {{else if (eq property.utilityMenuHoverEffect 'scale')}}
    transform: scale(1.05);
    {{/if}}
  }

  .language-buttons {
    display: flex;
    gap: {{property.languageButtonGap}}px;
    align-items: center;
  }

  .language-btn {
    background: {{property.languageButtonBg}};
    border: {{property.languageButtonBorder}}px solid {{property.languageButtonBorderColor}};
    border-radius: {{property.languageButtonRadius}}px;
    padding: {{property.languageButtonPadding}}px;
    color: {{property.languageButtonColor}};
    font-size: {{property.languageButtonSize}}px;
    cursor: pointer;
    text-decoration: none;
    white-space: nowrap;
    display: inline-block;
    {{#if (eq property.languageButtonHoverEffect 'opacity')}}
    transition: opacity 0.2s;
    {{else if (eq property.languageButtonHoverEffect 'color')}}
    transition: color 0.2s;
    {{else if (eq property.languageButtonHoverEffect 'background')}}
    transition: background 0.2s;
    {{else if (eq property.languageButtonHoverEffect 'scale')}}
    transition: transform 0.2s;
    {{else}}
    transition: all 0.2s;
    {{/if}}
  }

  .language-btn:hover {
    {{#if (eq property.languageButtonHoverEffect 'opacity')}}
    opacity: 0.6;
    {{else if (eq property.languageButtonHoverEffect 'color')}}
    color: {{property.languageButtonHoverColor}};
    {{else if (eq property.languageButtonHoverEffect 'background')}}
    background: {{property.languageButtonHoverBg}};
    {{else if (eq property.languageButtonHoverEffect 'underline')}}
    text-decoration: underline;
    {{else if (eq property.languageButtonHoverEffect 'scale')}}
    transform: scale(1.05);
    {{/if}}
  }

  .hamburger {
    display: none;
    background: none;
    border: none;
    cursor: pointer;
    padding: 8px;
  }

  .hamburger svg {
    width: 24px;
    height: 24px;
    stroke: {{property.menuColorDesktop}};
  }

  .nav-mobile {
    position: fixed;
    top: 0;
    right: -100%;
    width: 280px;
    height: 100vh;
    background: #fff;
    box-shadow: -2px 0 10px rgba(0,0,0,0.1);
    transition: right 0.3s;
    z-index: 2000;
    overflow-y: auto;
  }

  .nav-mobile.active {
    right: 0;
  }

  .mobile-header {
    padding: 20px;
    display: flex;
    justify-content: flex-end;
    border-bottom: 1px solid #eee;
  }

  .close-btn {
    background: none;
    border: none;
    cursor: pointer;
    padding: 8px;
  }

  .close-btn svg {
    width: 24px;
    height: 24px;
    stroke: {{property.menuColorMobile}};
  }

  .mobile-menu {
    padding: 20px;
  }

  .mobile-menu a {
    display: block;
    color: {{property.menuColorMobile}};
    font-size: {{property.menuSizeMobile}}px;
    text-decoration: none;
    padding: 15px 0;
    border-bottom: 1px solid #f5f5f5;
  }

  .overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100vh;
    background: rgba(0,0,0,0.5);
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s;
    z-index: 1999;
  }

  .overlay.active {
    opacity: 1;
    visibility: visible;
  }

  @media (max-width: 768px) {
    .header-container {
      padding: 0 20px;
      grid-template-columns: 1fr auto;
    }

    .header-center {
      display: none;
    }

    .nav-desktop {
      display: none;
    }

    .utility-menu {
      display: none;
    }

    .language-buttons {
      display: none;
    }

    .hamburger {
      display: block;
    }
  }
</style>

<template>
  <header class="global-header">
    <div class="header-container">
      <div class="header-left">
        {{#if (eq property.logoAlign 'left')}}
        <div class="logo">
          {{#if property.logoImage}}
          <a href="{{property.logoLink.value}}">
            <img src="{{property.logoImage}}" alt="Logo" />
          </a>
          {{/if}}
        </div>
        {{/if}}

        {{#if (eq property.menuAlign 'left')}}
        <nav class="nav-desktop">
          {{#each property.menuItems}}
          <a href="{{link.value}}">{{name}}</a>
          {{/each}}
        </nav>
        {{/if}}
      </div>

      <div class="header-center">
        {{#if (eq property.logoAlign 'center')}}
        <div class="logo">
          {{#if property.logoImage}}
          <a href="{{property.logoLink.value}}">
            <img src="{{property.logoImage}}" alt="Logo" />
          </a>
          {{/if}}
        </div>
        {{/if}}

        {{#if (eq property.menuAlign 'center')}}
        <nav class="nav-desktop">
          {{#each property.menuItems}}
          <a href="{{link.value}}">{{name}}</a>
          {{/each}}
        </nav>
        {{/if}}
      </div>

      <div class="header-right">
        <div class="header-right-content">
          {{#if (eq property.logoAlign 'right')}}
          <div class="logo">
            {{#if property.logoImage}}
            <a href="{{property.logoLink.value}}">
              <img src="{{property.logoImage}}" alt="Logo" />
            </a>
            {{/if}}
          </div>
          {{/if}}

          {{#if (eq property.menuAlign 'right')}}
          <nav class="nav-desktop">
            {{#each property.menuItems}}
            <a href="{{link.value}}">{{name}}</a>
            {{/each}}
          </nav>
          {{/if}}

          {{#if (gt (size property.utilityMenuItems) 0)}}
          <nav class="utility-menu">
            {{#each property.utilityMenuItems}}
            <div class="utility-item">
              {{#if iconSvg}}{{{iconSvg}}}{{/if}}
              <a href="{{link.value}}">{{name}}</a>
            </div>
            {{/each}}
          </nav>
          {{/if}}

          {{#if (gt (size property.languageButtons) 0)}}
          <div class="language-buttons">
            {{#each property.languageButtons}}
            <a href="{{link.value}}" class="language-btn">{{text}}</a>
            {{/each}}
          </div>
          {{/if}}
        </div>

        <button class="hamburger">
          <svg viewBox="0 0 24 24" fill="none" stroke-width="2">
            <line x1="3" y1="6" x2="21" y2="6"/>
            <line x1="3" y1="12" x2="21" y2="12"/>
            <line x1="3" y1="18" x2="21" y2="18"/>
          </svg>
        </button>
      </div>
    </div>
  </header>

  <div class="overlay"></div>

  <div class="nav-mobile">
    <div class="mobile-header">
      <button class="close-btn">
        <svg viewBox="0 0 24 24" fill="none" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"/>
          <line x1="6" y1="6" x2="18" y2="18"/>
        </svg>
      </button>
    </div>
    <div class="mobile-menu">
      {{#each property.menuItems}}
      <a href="{{link.value}}">{{name}}</a>
      {{/each}}
    </div>
  </div>
</template>

<script>
  const container = bm.container;
  const context = bm.context;

  function handleScroll() {
    const header = container.querySelector('.global-header');
    if (!header) return;

    if (!context.property.enableScrollStyle) {
      header.classList.remove('scrolled');
      return;
    }

    if (context.property.previewScrolled !== false) {
      header.classList.add('scrolled');
      return;
    }

    if (window.scrollY > context.property.scrollThreshold) {
      header.classList.add('scrolled');
    } else {
      header.classList.remove('scrolled');
    }
  }

  container.addEventListener('click', (e) => {
    const navMobile = container.querySelector('.nav-mobile');
    const overlay = container.querySelector('.overlay');

    if (e.target.closest('.hamburger')) {
      navMobile.classList.add('active');
      overlay.classList.add('active');
      document.body.style.overflow = 'hidden';
    }

    if (e.target.closest('.close-btn') || e.target.matches('.overlay')) {
      navMobile.classList.remove('active');
      overlay.classList.remove('active');
      document.body.style.overflow = '';
    }

    if (e.target.matches('.mobile-menu a')) {
      navMobile.classList.remove('active');
      overlay.classList.remove('active');
      document.body.style.overflow = '';
    }

    // 빈 링크 클릭 방지
    const link = e.target.closest('a');
    if (link) {
      const href = link.getAttribute('href');
      if (!href || href === '' || href === '#' || href === 'null' || href === 'undefined') {
        e.preventDefault();
        e.stopPropagation();
      }
    }
  }, true);

  if (context.property.enableScrollStyle) {
    window.addEventListener('scroll', handleScroll, { passive: true });
    handleScroll();
  }

  bm.onContextChange = () => {
    handleScroll();
  };

  bm.onDestroy = () => {
    window.removeEventListener('scroll', handleScroll);
    document.body.style.overflow = '';
  };
</script>
