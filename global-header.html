<style>
  .global-header {
    width: 100%;
    height: {{property.headerHeight}}px;
    {{#if (eq property.headerBgType 'gradient')}}
    background: linear-gradient({{property.headerGradientAngle}}deg, {{property.headerGradientStart}}, {{property.headerGradientEnd}});
    {{else}}
    background: {{property.headerBg}};
    {{/if}}
    {{#if (gt property.headerShadow 0)}}
    box-shadow: 0 2px {{property.headerShadow}}px {{property.headerShadowColor}};
    {{/if}}
    {{#if (gt property.headerBlur 0)}}
    backdrop-filter: blur({{property.headerBlur}}px);
    -webkit-backdrop-filter: blur({{property.headerBlur}}px);
    {{/if}}
    {{#if (gt property.headerBorder 0)}}
    border-bottom: {{property.headerBorder}}px solid {{property.headerBorderColor}};
    {{/if}}
    transition: all 0.3s ease;
    z-index: 1000;

    {{#if property.isOverlay}}
    position: {{#if property.isSticky}}fixed{{else}}absolute{{/if}};
    top: 0;
    left: 0;
    {{else}}
      {{#if property.isSticky}}
      position: sticky;
      top: 0;
      {{else}}
      position: relative;
      {{/if}}
    {{/if}}
  }

  {{#if property.enableScrollStyle}}
  .global-header.scrolled {
    {{#if (eq property.scrollBgType 'gradient')}}
    background: linear-gradient({{property.scrollGradientAngle}}deg, {{property.scrollGradientStart}}, {{property.scrollGradientEnd}}) !important;
    {{else}}
    background: {{property.scrollBg}} !important;
    {{/if}}
    {{#if (gt property.scrollShadow 0)}}
    box-shadow: 0 2px {{property.scrollShadow}}px {{property.scrollShadowColor}} !important;
    {{else}}
    box-shadow: none !important;
    {{/if}}
    {{#if (gt property.scrollBlur 0)}}
    backdrop-filter: blur({{property.scrollBlur}}px) !important;
    -webkit-backdrop-filter: blur({{property.scrollBlur}}px) !important;
    {{/if}}
    {{#if property.scrollHeaderHeightEnabled}}
    height: {{property.scrollHeaderHeight}}px !important;
    {{/if}}
  }

  {{#if property.scrollLogoWidthEnabled}}
  .global-header.scrolled .logo img {
    width: {{property.scrollLogoWidth}}px !important;
  }
  {{/if}}
  {{/if}}

  .header-container {
    {{#if property.containerMaxWidthEnabled}}
    max-width: {{property.containerMaxWidth}}px;
    margin: 0 auto;
    padding: 0 {{property.containerPaddingDesktop}}px;
    {{else}}
    max-width: 100%;
    padding: 0 {{property.headerPadding}}px;
    {{/if}}
    height: 100%;
    display: grid;
    grid-template-columns: 1fr auto 1fr;
    align-items: center;
    gap: 20px;
  }

  .header-left {
    display: flex;
    {{#if (eq property.logoAlign 'left')}}
    justify-content: flex-start;
    {{else if (eq property.logoAlign 'center')}}
    justify-content: center;
    {{else}}
    justify-content: flex-end;
    {{/if}}
  }

  .header-center {
    display: flex;
    justify-content: center;
  }

  .header-right {
    display: flex;
    align-items: center;
    gap: 20px;
    {{#if (eq property.menuAlign 'left')}}
    justify-content: flex-start;
    {{else if (eq property.menuAlign 'center')}}
    justify-content: center;
    {{else}}
    justify-content: flex-end;
    {{/if}}
  }

  .header-right-content {
    display: flex;
    align-items: center;
    gap: 20px;
    margin-left: auto;  /* flex container 내에서 오른쪽으로 밀기 */
  }

  /* 오른쪽 끝으로 밀어내기: container padding을 음수 margin으로 상쇄 */
  {{#if property.containerMaxWidthEnabled}}
  .header-right-content {
    margin-right: -{{property.containerPaddingDesktop}}px;
    padding-right: {{property.headerRightMargin}}px;
  }
  {{else}}
  .header-right-content {
    margin-right: -{{property.headerPadding}}px;
    padding-right: {{property.headerRightMargin}}px;
  }
  {{/if}}

  .logo {
    display: flex;
    align-items: center;
    margin: {{property.logoMarginY}}px {{property.logoMarginX}}px;
  }

  .logo a {
    display: block;
    line-height: 0;
  }

  {{#if property.logoImage}}
  .logo img {
    width: {{property.logoWidth}}px;
    height: auto;
    transition: width 0.3s ease;
  }
  {{/if}}

  .nav-desktop {
    display: flex;
    gap: {{property.menuGapDesktop}}px;
    align-items: center;
    margin: {{property.menuMarginY}}px {{property.menuMarginX}}px;
  }

  .menu-item-wrapper {
    position: static;
  }

  /* 하위 메뉴 컨테이너 */
  .submenu {
    position: absolute;
    {{#if (and property.enableScrollStyle property.scrollHeaderHeightEnabled)}}
    top: {{property.headerHeight}}px;
    {{else}}
    top: {{property.headerHeight}}px;
    {{/if}}
    left: 0;
    width: 100%;
    background: {{property.submenuBg}};
    {{#if property.submenuBlurEnabled}}
    backdrop-filter: blur({{property.submenuBlur}}px);
    -webkit-backdrop-filter: blur({{property.submenuBlur}}px);
    /* 블러 효과를 위한 독립적인 레이어 생성 */
    /* transform을 사용하여 새로운 stacking context를 생성하고 GPU 레이어를 분리 */
    /* 이렇게 하면 부모(.global-header)의 backdrop-filter와 독립적으로 작동함 */
    transform: translateZ(0);
    isolation: isolate;
    will-change: backdrop-filter;
    {{/if}}
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.2s ease, visibility 0.2s ease;
    z-index: 10001; /* 헤더(1000)보다 높게 설정하여 완전히 분리 */
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  }

  .global-header.scrolled .submenu {
    {{#if (and property.enableScrollStyle property.scrollHeaderHeightEnabled)}}
    top: {{property.scrollHeaderHeight}}px;
    {{/if}}
  }

  .menu-item-wrapper:hover .submenu {
    opacity: 1;
    visibility: visible;
  }

  /* 하위 메뉴 내용 - 헤더와 같은 grid 구조 */
  .submenu-content {
    {{#if property.containerMaxWidthEnabled}}
    max-width: {{property.containerMaxWidth}}px;
    margin: 0 auto;
    padding: {{property.submenuPaddingTop}}px {{property.containerPaddingDesktop}}px {{property.submenuPaddingBottom}}px;
    {{else}}
    max-width: 100%;
    padding: {{property.submenuPaddingTop}}px {{property.headerPadding}}px {{property.submenuPaddingBottom}}px;
    {{/if}}
    display: grid;
    grid-template-columns: 1fr auto 1fr;
    align-items: start;
  }

  /* 하위 메뉴의 좌/중/우 컬럼 */
  .submenu-left,
  .submenu-center,
  .submenu-right {
    display: flex;
    align-items: flex-start;
  }

  /* 로고 자리 차지용 */
  .submenu-logo-placeholder {
    flex-shrink: 0;
  }

  /* 하위 메뉴 그룹들의 컨테이너 */
  .submenu-groups-wrapper {
    display: flex;
    flex-direction: row;
    gap: {{property.submenuGroupGap}}px;
    align-items: flex-start;
  }

  .submenu-left .submenu-groups-wrapper {
    justify-content: flex-start;
  }

  .submenu-center .submenu-groups-wrapper {
    justify-content: center;
  }

  .submenu-right .submenu-groups-wrapper {
    justify-content: flex-end;
  }

  /* 그룹 컨테이너 */
  .submenu-group {
    display: flex;
    flex-direction: column;
    gap: 8px;
    flex: 0 0 auto;
    min-width: 200px;
  }

  /* 그룹 제목 */
  .submenu-group-title {
    color: {{property.submenuTitleColor}} !important;
    font-size: {{property.submenuTitleSize}}px !important;
    font-weight: {{property.submenuTitleWeight}};
    padding: {{property.submenuTitlePaddingY}}px {{property.submenuTitlePaddingX}}px;
    margin-bottom: {{property.submenuTitleMarginBottom}}px;
    pointer-events: none;
    {{#if property.submenuTitleUnderline}}
    border-bottom: {{property.submenuTitleUnderlineWidth}}px solid {{property.submenuTitleUnderlineColor}};
    {{/if}}
  }

  /* 하위 메뉴 항목 */
  .submenu-item {
    display: block;
    color: {{property.submenuColor}} !important;
    font-size: {{property.submenuSize}}px !important;
    font-weight: {{property.submenuItemWeight}};
    padding: {{property.submenuItemPaddingY}}px {{property.submenuItemPaddingX}}px;
    margin: {{property.submenuItemMargin}}px 0;
    text-decoration: none !important;
    transition: all 0.2s;
    border-radius: {{property.submenuItemRadius}}px;
  }

  .submenu-item:hover {
    {{#if (eq property.submenuHoverEffect 'background')}}
    background: {{property.submenuHoverBg}} !important;
    {{else if (eq property.submenuHoverEffect 'underline')}}
    text-decoration: underline !important;
    {{else if (eq property.submenuHoverEffect 'bold')}}
    font-weight: bold;
    {{else if (eq property.submenuHoverEffect 'background-bold')}}
    background: {{property.submenuHoverBg}} !important;
    font-weight: bold;
    {{else if (eq property.submenuHoverEffect 'color')}}
    color: {{property.submenuHoverColor}} !important;
    {{else if (eq property.submenuHoverEffect 'color-bold')}}
    color: {{property.submenuHoverColor}} !important;
    font-weight: bold;
    {{else if (eq property.submenuHoverEffect 'scale')}}
    transform: scale(1.05);
    {{else if (eq property.submenuHoverEffect 'shadow')}}
    box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    {{else if (eq property.submenuHoverEffect 'background-color')}}
    background: {{property.submenuHoverBg}} !important;
    color: {{property.submenuHoverColor}} !important;
    {{/if}}
  }

  .submenu-item::after,
  .submenu-item::before {
    display: none !important;
  }

  .nav-desktop > a,
  .menu-item-wrapper > a {
    color: {{property.menuColorDesktop}};
    font-size: {{property.menuSizeDesktop}}px;
    text-decoration: none;
    white-space: nowrap;
    position: relative;
    display: inline-block;
    {{#if (eq property.menuHoverEffect 'opacity')}}
    transition: opacity 0.3s;
    {{else if (eq property.menuHoverEffect 'color')}}
    transition: color 0.3s;
    {{else if (eq property.menuHoverEffect 'scale')}}
    transition: transform 0.3s;
    {{else if (eq property.menuHoverEffect 'background-slide')}}
    padding: 8px 16px;
    overflow: hidden;
    transition: color 0.3s;
    {{else}}
    transition: all 0.3s;
    {{/if}}
  }

  {{#if (eq property.menuHoverEffect 'underline-slide')}}
  .nav-desktop > a::after,
  .menu-item-wrapper > a::after {
    content: '';
    position: absolute;
    bottom: -4px;
    left: 0;
    width: 0;
    height: {{property.menuUnderlineThickness}}px;
    background: {{property.menuUnderlineColor}};
    transition: width 0.3s ease;
  }
  .nav-desktop > a:hover::after,
  .menu-item-wrapper > a:hover::after {
    width: 100%;
  }
  {{else if (eq property.menuHoverEffect 'underline-center')}}
  .nav-desktop > a::after,
  .menu-item-wrapper > a::after {
    content: '';
    position: absolute;
    bottom: -4px;
    left: 50%;
    transform: translateX(-50%);
    width: 0;
    height: {{property.menuUnderlineThickness}}px;
    background: {{property.menuUnderlineColor}};
    transition: width 0.3s ease;
  }
  .nav-desktop > a:hover::after,
  .menu-item-wrapper > a:hover::after {
    width: 100%;
  }
  {{else if (eq property.menuHoverEffect 'background-slide')}}
  .nav-desktop > a::before,
  .menu-item-wrapper > a::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 0;
    height: 100%;
    background: {{property.menuHoverBgColor}};
    transition: width 0.3s ease;
    z-index: -1;
  }
  .nav-desktop > a:hover::before,
  .menu-item-wrapper > a:hover::before {
    width: 100%;
  }
  {{/if}}

  .nav-desktop > a:hover,
  .menu-item-wrapper > a:hover {
    {{#if (eq property.menuHoverEffect 'opacity')}}
    opacity: 0.6;
    {{else if (eq property.menuHoverEffect 'color')}}
    color: {{property.menuHoverColor}};
    {{else if (eq property.menuHoverEffect 'underline')}}
    text-decoration: underline;
    text-decoration-color: {{property.menuUnderlineColor}};
    text-decoration-thickness: {{property.menuUnderlineThickness}}px;
    text-underline-offset: 4px;
    {{else if (eq property.menuHoverEffect 'scale')}}
    transform: scale(1.05);
    {{/if}}
  }

  .utility-menu {
    display: flex;
    gap: {{property.utilityMenuGap}}px;
    align-items: center;
  }

  .utility-item {
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .utility-item svg {
    width: {{property.utilityIconSize}}px;
    height: {{property.utilityIconSize}}px;
  }

  .utility-item svg * {
    stroke: {{property.utilityIconColor}};
    fill: {{property.utilityIconColor}};
  }

  .utility-menu a {
    color: {{property.utilityMenuColor}};
    font-size: {{property.utilityMenuSize}}px;
    text-decoration: none;
    {{#if (eq property.utilityMenuHoverEffect 'opacity')}}
    transition: opacity 0.2s;
    {{else if (eq property.utilityMenuHoverEffect 'color')}}
    transition: color 0.2s;
    {{else if (eq property.utilityMenuHoverEffect 'scale')}}
    transition: transform 0.2s;
    {{else}}
    transition: all 0.2s;
    {{/if}}
  }

  .utility-menu a:hover {
    {{#if (eq property.utilityMenuHoverEffect 'opacity')}}
    opacity: 0.6;
    {{else if (eq property.utilityMenuHoverEffect 'color')}}
    color: {{property.utilityMenuHoverColor}};
    {{else if (eq property.utilityMenuHoverEffect 'underline')}}
    text-decoration: underline;
    {{else if (eq property.utilityMenuHoverEffect 'scale')}}
    transform: scale(1.05);
    {{/if}}
  }

  .language-buttons {
    display: flex;
    gap: {{property.languageButtonGap}}px;
    align-items: center;
  }

  {{#if (eq property.languageButtonAlign 'right')}}
  .header-right .language-buttons {
    margin-right: {{property.languageButtonMarginRight}}px;
  }
  {{/if}}

  .language-btn {
    background: {{property.languageButtonBg}};
    border: {{property.languageButtonBorder}}px solid {{property.languageButtonBorderColor}};
    border-radius: {{property.languageButtonRadius}}px;
    color: {{property.languageButtonColor}};
    font-size: {{property.languageButtonSize}}px;
    cursor: pointer;
    text-decoration: none;
    white-space: nowrap;
    display: inline-block;
    {{#if (eq property.languageButtonHoverEffect 'opacity')}}
    transition: opacity 0.2s;
    {{else if (eq property.languageButtonHoverEffect 'color')}}
    transition: color 0.2s;
    {{else if (eq property.languageButtonHoverEffect 'background')}}
    transition: background 0.2s;
    {{else if (eq property.languageButtonHoverEffect 'scale')}}
    transition: transform 0.2s;
    {{else}}
    transition: all 0.2s;
    {{/if}}
  }

  .language-btn:hover {
    {{#if (eq property.languageButtonHoverEffect 'opacity')}}
    opacity: 0.6;
    {{else if (eq property.languageButtonHoverEffect 'color')}}
    color: {{property.languageButtonHoverColor}};
    {{else if (eq property.languageButtonHoverEffect 'background')}}
    background: {{property.languageButtonHoverBg}};
    {{else if (eq property.languageButtonHoverEffect 'underline')}}
    text-decoration: underline;
    {{else if (eq property.languageButtonHoverEffect 'scale')}}
    transform: scale(1.05);
    {{/if}}
  }

  .language-btn.active {
    {{#if (eq property.languageActiveStyle 'background')}}
    background: {{property.languageActiveBg}} !important;
    color: {{property.languageActiveTextColor}} !important;
    {{else if (eq property.languageActiveStyle 'border')}}
    border: {{property.languageActiveBorderWidth}}px solid {{property.languageActiveBorderColor}} !important;
    color: {{property.languageActiveTextColor}} !important;
    {{else if (eq property.languageActiveStyle 'underline')}}
    text-decoration: underline;
    text-underline-offset: 4px;
    color: {{property.languageActiveTextColor}} !important;
    {{else if (eq property.languageActiveStyle 'bold')}}
    font-weight: bold;
    color: {{property.languageActiveTextColor}} !important;
    {{else if (eq property.languageActiveStyle 'bold-underline')}}
    font-weight: bold;
    text-decoration: underline;
    text-underline-offset: 4px;
    color: {{property.languageActiveTextColor}} !important;
    {{else if (eq property.languageActiveStyle 'background-border')}}
    background: {{property.languageActiveBg}} !important;
    border: {{property.languageActiveBorderWidth}}px solid {{property.languageActiveBorderColor}} !important;
    color: {{property.languageActiveTextColor}} !important;
    {{/if}}
  }

  .hamburger {
    display: none;
    background: none;
    border: none;
    cursor: pointer;
    padding: 8px;
  }

  .hamburger svg {
    width: 24px;
    height: 24px;
    stroke: {{property.menuColorDesktop}};
  }

  .nav-mobile {
    position: fixed;
    top: 0;
    right: -100%;
    width: 280px;
    height: 100vh;
    background: #fff;
    box-shadow: -2px 0 10px rgba(0,0,0,0.1);
    transition: right 0.3s;
    z-index: 2000;
    overflow-y: auto;
  }

  .nav-mobile.active {
    right: 0;
  }

  .mobile-header {
    padding: 20px;
    display: flex;
    justify-content: flex-end;
    border-bottom: 1px solid #eee;
  }

  .close-btn {
    background: none;
    border: none;
    cursor: pointer;
    padding: 8px;
  }

  .close-btn svg {
    width: 24px;
    height: 24px;
    stroke: {{property.menuColorMobile}};
  }

  .mobile-menu {
    padding: 20px;
  }

  .mobile-menu a {
    display: block;
    color: {{property.menuColorMobile}};
    font-size: {{property.menuSizeMobile}}px;
    text-decoration: none;
    padding: 15px 0;
    border-bottom: 1px solid #f5f5f5;
  }

  .overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100vh;
    background: rgba(0,0,0,0.5);
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s;
    z-index: 1999;
  }

  .overlay.active {
    opacity: 1;
    visibility: visible;
  }

  @media (max-width: 768px) {
    .header-container {
      padding: 0 20px;
      grid-template-columns: 1fr auto;
    }

    .header-center {
      display: none;
    }

    .nav-desktop {
      display: none;
    }

    .utility-menu {
      display: none;
    }

    .language-buttons {
      display: none;
    }

    .hamburger {
      display: block;
    }
  }
</style>

<template>
  <header class="global-header">
    <div class="header-container">
      <div class="header-left">
        {{#if (eq property.logoAlign 'left')}}
        <div class="logo">
          {{#if property.logoImage}}
          <a href="{{property.logoLink.value}}">
            <img src="{{property.logoImage}}" alt="Logo" />
          </a>
          {{/if}}
        </div>
        {{/if}}

        {{#if (eq property.menuAlign 'left')}}
        <nav class="nav-desktop">
          {{#each property.menuItems}}
            {{#if hasSubmenu}}
            <div class="menu-item-wrapper">
              <a href="{{link.value}}">{{name}}</a>
              <div class="submenu">
                <div class="submenu-content">
                  <div class="submenu-left">
                    {{#if (and (eq ../property.logoAlign 'left') ../property.logoImage)}}
                    <div class="submenu-logo-placeholder" style="width: {{../property.logoWidth}}px; margin-right: 20px;"></div>
                    {{/if}}
                    {{#if (eq ../property.menuAlign 'left')}}
                    <div class="submenu-groups-wrapper">
                      {{#if (or group1Title group1Item1Name group1Item2Name group1Item3Name group1Item4Name group1Item5Name)}}
                      <div class="submenu-group">
                        {{#if group1Title}}<div class="submenu-group-title">{{group1Title}}</div>{{/if}}
                        {{#if group1Item1Name}}<a class="submenu-item" href="{{group1Item1Link.value}}">{{group1Item1Name}}</a>{{/if}}
                        {{#if group1Item2Name}}<a class="submenu-item" href="{{group1Item2Link.value}}">{{group1Item2Name}}</a>{{/if}}
                        {{#if group1Item3Name}}<a class="submenu-item" href="{{group1Item3Link.value}}">{{group1Item3Name}}</a>{{/if}}
                        {{#if group1Item4Name}}<a class="submenu-item" href="{{group1Item4Link.value}}">{{group1Item4Name}}</a>{{/if}}
                        {{#if group1Item5Name}}<a class="submenu-item" href="{{group1Item5Link.value}}">{{group1Item5Name}}</a>{{/if}}
                      </div>
                      {{/if}}
                      {{#if (or group2Title group2Item1Name group2Item2Name group2Item3Name group2Item4Name group2Item5Name)}}
                      <div class="submenu-group">
                        {{#if group2Title}}<div class="submenu-group-title">{{group2Title}}</div>{{/if}}
                        {{#if group2Item1Name}}<a class="submenu-item" href="{{group2Item1Link.value}}">{{group2Item1Name}}</a>{{/if}}
                        {{#if group2Item2Name}}<a class="submenu-item" href="{{group2Item2Link.value}}">{{group2Item2Name}}</a>{{/if}}
                        {{#if group2Item3Name}}<a class="submenu-item" href="{{group2Item3Link.value}}">{{group2Item3Name}}</a>{{/if}}
                        {{#if group2Item4Name}}<a class="submenu-item" href="{{group2Item4Link.value}}">{{group2Item4Name}}</a>{{/if}}
                        {{#if group2Item5Name}}<a class="submenu-item" href="{{group2Item5Link.value}}">{{group2Item5Name}}</a>{{/if}}
                      </div>
                      {{/if}}
                      {{#if (or group3Title group3Item1Name group3Item2Name group3Item3Name group3Item4Name group3Item5Name)}}
                      <div class="submenu-group">
                        {{#if group3Title}}<div class="submenu-group-title">{{group3Title}}</div>{{/if}}
                        {{#if group3Item1Name}}<a class="submenu-item" href="{{group3Item1Link.value}}">{{group3Item1Name}}</a>{{/if}}
                        {{#if group3Item2Name}}<a class="submenu-item" href="{{group3Item2Link.value}}">{{group3Item2Name}}</a>{{/if}}
                        {{#if group3Item3Name}}<a class="submenu-item" href="{{group3Item3Link.value}}">{{group3Item3Name}}</a>{{/if}}
                        {{#if group3Item4Name}}<a class="submenu-item" href="{{group3Item4Link.value}}">{{group3Item4Name}}</a>{{/if}}
                        {{#if group3Item5Name}}<a class="submenu-item" href="{{group3Item5Link.value}}">{{group3Item5Name}}</a>{{/if}}
                      </div>
                      {{/if}}
                    </div>
                    {{/if}}
                  </div>
                  <div class="submenu-center">
                    {{#if (and (eq ../property.logoAlign 'center') ../property.logoImage)}}
                    <div class="submenu-logo-placeholder" style="width: {{../property.logoWidth}}px; margin-right: 20px;"></div>
                    {{/if}}
                    {{#if (eq ../property.menuAlign 'center')}}
                    <div class="submenu-groups-wrapper">
                      {{#if (or group1Title group1Item1Name group1Item2Name group1Item3Name group1Item4Name group1Item5Name)}}
                      <div class="submenu-group">
                        {{#if group1Title}}<div class="submenu-group-title">{{group1Title}}</div>{{/if}}
                        {{#if group1Item1Name}}<a class="submenu-item" href="{{group1Item1Link.value}}">{{group1Item1Name}}</a>{{/if}}
                        {{#if group1Item2Name}}<a class="submenu-item" href="{{group1Item2Link.value}}">{{group1Item2Name}}</a>{{/if}}
                        {{#if group1Item3Name}}<a class="submenu-item" href="{{group1Item3Link.value}}">{{group1Item3Name}}</a>{{/if}}
                        {{#if group1Item4Name}}<a class="submenu-item" href="{{group1Item4Link.value}}">{{group1Item4Name}}</a>{{/if}}
                        {{#if group1Item5Name}}<a class="submenu-item" href="{{group1Item5Link.value}}">{{group1Item5Name}}</a>{{/if}}
                      </div>
                      {{/if}}
                      {{#if (or group2Title group2Item1Name group2Item2Name group2Item3Name group2Item4Name group2Item5Name)}}
                      <div class="submenu-group">
                        {{#if group2Title}}<div class="submenu-group-title">{{group2Title}}</div>{{/if}}
                        {{#if group2Item1Name}}<a class="submenu-item" href="{{group2Item1Link.value}}">{{group2Item1Name}}</a>{{/if}}
                        {{#if group2Item2Name}}<a class="submenu-item" href="{{group2Item2Link.value}}">{{group2Item2Name}}</a>{{/if}}
                        {{#if group2Item3Name}}<a class="submenu-item" href="{{group2Item3Link.value}}">{{group2Item3Name}}</a>{{/if}}
                        {{#if group2Item4Name}}<a class="submenu-item" href="{{group2Item4Link.value}}">{{group2Item4Name}}</a>{{/if}}
                        {{#if group2Item5Name}}<a class="submenu-item" href="{{group2Item5Link.value}}">{{group2Item5Name}}</a>{{/if}}
                      </div>
                      {{/if}}
                      {{#if (or group3Title group3Item1Name group3Item2Name group3Item3Name group3Item4Name group3Item5Name)}}
                      <div class="submenu-group">
                        {{#if group3Title}}<div class="submenu-group-title">{{group3Title}}</div>{{/if}}
                        {{#if group3Item1Name}}<a class="submenu-item" href="{{group3Item1Link.value}}">{{group3Item1Name}}</a>{{/if}}
                        {{#if group3Item2Name}}<a class="submenu-item" href="{{group3Item2Link.value}}">{{group3Item2Name}}</a>{{/if}}
                        {{#if group3Item3Name}}<a class="submenu-item" href="{{group3Item3Link.value}}">{{group3Item3Name}}</a>{{/if}}
                        {{#if group3Item4Name}}<a class="submenu-item" href="{{group3Item4Link.value}}">{{group3Item4Name}}</a>{{/if}}
                        {{#if group3Item5Name}}<a class="submenu-item" href="{{group3Item5Link.value}}">{{group3Item5Name}}</a>{{/if}}
                      </div>
                      {{/if}}
                    </div>
                    {{/if}}
                  </div>
                  <div class="submenu-right">
                    {{#if (and (eq ../property.logoAlign 'right') ../property.logoImage)}}
                    <div class="submenu-logo-placeholder" style="width: {{../property.logoWidth}}px; margin-right: 20px;"></div>
                    {{/if}}
                    {{#if (eq ../property.menuAlign 'right')}}
                    <div class="submenu-groups-wrapper">
                      {{#if (or group1Title group1Item1Name group1Item2Name group1Item3Name group1Item4Name group1Item5Name)}}
                      <div class="submenu-group">
                        {{#if group1Title}}<div class="submenu-group-title">{{group1Title}}</div>{{/if}}
                        {{#if group1Item1Name}}<a class="submenu-item" href="{{group1Item1Link.value}}">{{group1Item1Name}}</a>{{/if}}
                        {{#if group1Item2Name}}<a class="submenu-item" href="{{group1Item2Link.value}}">{{group1Item2Name}}</a>{{/if}}
                        {{#if group1Item3Name}}<a class="submenu-item" href="{{group1Item3Link.value}}">{{group1Item3Name}}</a>{{/if}}
                        {{#if group1Item4Name}}<a class="submenu-item" href="{{group1Item4Link.value}}">{{group1Item4Name}}</a>{{/if}}
                        {{#if group1Item5Name}}<a class="submenu-item" href="{{group1Item5Link.value}}">{{group1Item5Name}}</a>{{/if}}
                      </div>
                      {{/if}}
                      {{#if (or group2Title group2Item1Name group2Item2Name group2Item3Name group2Item4Name group2Item5Name)}}
                      <div class="submenu-group">
                        {{#if group2Title}}<div class="submenu-group-title">{{group2Title}}</div>{{/if}}
                        {{#if group2Item1Name}}<a class="submenu-item" href="{{group2Item1Link.value}}">{{group2Item1Name}}</a>{{/if}}
                        {{#if group2Item2Name}}<a class="submenu-item" href="{{group2Item2Link.value}}">{{group2Item2Name}}</a>{{/if}}
                        {{#if group2Item3Name}}<a class="submenu-item" href="{{group2Item3Link.value}}">{{group2Item3Name}}</a>{{/if}}
                        {{#if group2Item4Name}}<a class="submenu-item" href="{{group2Item4Link.value}}">{{group2Item4Name}}</a>{{/if}}
                        {{#if group2Item5Name}}<a class="submenu-item" href="{{group2Item5Link.value}}">{{group2Item5Name}}</a>{{/if}}
                      </div>
                      {{/if}}
                      {{#if (or group3Title group3Item1Name group3Item2Name group3Item3Name group3Item4Name group3Item5Name)}}
                      <div class="submenu-group">
                        {{#if group3Title}}<div class="submenu-group-title">{{group3Title}}</div>{{/if}}
                        {{#if group3Item1Name}}<a class="submenu-item" href="{{group3Item1Link.value}}">{{group3Item1Name}}</a>{{/if}}
                        {{#if group3Item2Name}}<a class="submenu-item" href="{{group3Item2Link.value}}">{{group3Item2Name}}</a>{{/if}}
                        {{#if group3Item3Name}}<a class="submenu-item" href="{{group3Item3Link.value}}">{{group3Item3Name}}</a>{{/if}}
                        {{#if group3Item4Name}}<a class="submenu-item" href="{{group3Item4Link.value}}">{{group3Item4Name}}</a>{{/if}}
                        {{#if group3Item5Name}}<a class="submenu-item" href="{{group3Item5Link.value}}">{{group3Item5Name}}</a>{{/if}}
                      </div>
                      {{/if}}
                    </div>
                    {{/if}}
                  </div>
                </div>
              </div>
            </div>
            {{else}}
            <a href="{{link.value}}">{{name}}</a>
            {{/if}}
          {{/each}}
        </nav>
        {{/if}}

        {{#if (and (eq property.utilityMenuAlign 'left') (gt (size property.utilityMenuItems) 0))}}
        <nav class="utility-menu">
          {{#each property.utilityMenuItems}}
          <div class="utility-item">
            {{#if (eq ../property.utilityIconPosition 'left')}}
              {{#if iconSvg}}{{{iconSvg}}}{{/if}}
              <a href="{{link.value}}">{{name}}</a>
            {{else}}
              <a href="{{link.value}}">{{name}}</a>
              {{#if iconSvg}}{{{iconSvg}}}{{/if}}
            {{/if}}
          </div>
          {{/each}}
        </nav>
        {{/if}}

        {{#if (and (eq property.languageButtonAlign 'left') (gt (size property.languageButtons) 0))}}
        <div class="language-buttons">
          {{#each property.languageButtons}}
          <a href="{{link.value}}" class="language-btn {{#if isActive}}active{{/if}}">{{text}}</a>
          {{/each}}
        </div>
        {{/if}}
      </div>

      <div class="header-center">
        {{#if (eq property.logoAlign 'center')}}
        <div class="logo">
          {{#if property.logoImage}}
          <a href="{{property.logoLink.value}}">
            <img src="{{property.logoImage}}" alt="Logo" />
          </a>
          {{/if}}
        </div>
        {{/if}}

        {{#if (eq property.menuAlign 'center')}}
        <nav class="nav-desktop">
          {{#each property.menuItems}}
            {{#if hasSubmenu}}
            <div class="menu-item-wrapper">
              <a href="{{link.value}}">{{name}}</a>
              <div class="submenu">
                <div class="submenu-content">
                  <div class="submenu-left">
                    {{#if (and (eq ../property.logoAlign 'left') ../property.logoImage)}}
                    <div class="submenu-logo-placeholder" style="width: {{../property.logoWidth}}px; margin-right: 20px;"></div>
                    {{/if}}
                    {{#if (eq ../property.menuAlign 'left')}}
                    <div class="submenu-groups-wrapper">
                      {{#if (or group1Title group1Item1Name group1Item2Name group1Item3Name group1Item4Name group1Item5Name)}}
                      <div class="submenu-group">
                        {{#if group1Title}}<div class="submenu-group-title">{{group1Title}}</div>{{/if}}
                        {{#if group1Item1Name}}<a class="submenu-item" href="{{group1Item1Link.value}}">{{group1Item1Name}}</a>{{/if}}
                        {{#if group1Item2Name}}<a class="submenu-item" href="{{group1Item2Link.value}}">{{group1Item2Name}}</a>{{/if}}
                        {{#if group1Item3Name}}<a class="submenu-item" href="{{group1Item3Link.value}}">{{group1Item3Name}}</a>{{/if}}
                        {{#if group1Item4Name}}<a class="submenu-item" href="{{group1Item4Link.value}}">{{group1Item4Name}}</a>{{/if}}
                        {{#if group1Item5Name}}<a class="submenu-item" href="{{group1Item5Link.value}}">{{group1Item5Name}}</a>{{/if}}
                      </div>
                      {{/if}}
                      {{#if (or group2Title group2Item1Name group2Item2Name group2Item3Name group2Item4Name group2Item5Name)}}
                      <div class="submenu-group">
                        {{#if group2Title}}<div class="submenu-group-title">{{group2Title}}</div>{{/if}}
                        {{#if group2Item1Name}}<a class="submenu-item" href="{{group2Item1Link.value}}">{{group2Item1Name}}</a>{{/if}}
                        {{#if group2Item2Name}}<a class="submenu-item" href="{{group2Item2Link.value}}">{{group2Item2Name}}</a>{{/if}}
                        {{#if group2Item3Name}}<a class="submenu-item" href="{{group2Item3Link.value}}">{{group2Item3Name}}</a>{{/if}}
                        {{#if group2Item4Name}}<a class="submenu-item" href="{{group2Item4Link.value}}">{{group2Item4Name}}</a>{{/if}}
                        {{#if group2Item5Name}}<a class="submenu-item" href="{{group2Item5Link.value}}">{{group2Item5Name}}</a>{{/if}}
                      </div>
                      {{/if}}
                      {{#if (or group3Title group3Item1Name group3Item2Name group3Item3Name group3Item4Name group3Item5Name)}}
                      <div class="submenu-group">
                        {{#if group3Title}}<div class="submenu-group-title">{{group3Title}}</div>{{/if}}
                        {{#if group3Item1Name}}<a class="submenu-item" href="{{group3Item1Link.value}}">{{group3Item1Name}}</a>{{/if}}
                        {{#if group3Item2Name}}<a class="submenu-item" href="{{group3Item2Link.value}}">{{group3Item2Name}}</a>{{/if}}
                        {{#if group3Item3Name}}<a class="submenu-item" href="{{group3Item3Link.value}}">{{group3Item3Name}}</a>{{/if}}
                        {{#if group3Item4Name}}<a class="submenu-item" href="{{group3Item4Link.value}}">{{group3Item4Name}}</a>{{/if}}
                        {{#if group3Item5Name}}<a class="submenu-item" href="{{group3Item5Link.value}}">{{group3Item5Name}}</a>{{/if}}
                      </div>
                      {{/if}}
                    </div>
                    {{/if}}
                  </div>
                  <div class="submenu-center">
                    {{#if (and (eq ../property.logoAlign 'center') ../property.logoImage)}}
                    <div class="submenu-logo-placeholder" style="width: {{../property.logoWidth}}px; margin-right: 20px;"></div>
                    {{/if}}
                    {{#if (eq ../property.menuAlign 'center')}}
                    <div class="submenu-groups-wrapper">
                      {{#if (or group1Title group1Item1Name group1Item2Name group1Item3Name group1Item4Name group1Item5Name)}}
                      <div class="submenu-group">
                        {{#if group1Title}}<div class="submenu-group-title">{{group1Title}}</div>{{/if}}
                        {{#if group1Item1Name}}<a class="submenu-item" href="{{group1Item1Link.value}}">{{group1Item1Name}}</a>{{/if}}
                        {{#if group1Item2Name}}<a class="submenu-item" href="{{group1Item2Link.value}}">{{group1Item2Name}}</a>{{/if}}
                        {{#if group1Item3Name}}<a class="submenu-item" href="{{group1Item3Link.value}}">{{group1Item3Name}}</a>{{/if}}
                        {{#if group1Item4Name}}<a class="submenu-item" href="{{group1Item4Link.value}}">{{group1Item4Name}}</a>{{/if}}
                        {{#if group1Item5Name}}<a class="submenu-item" href="{{group1Item5Link.value}}">{{group1Item5Name}}</a>{{/if}}
                      </div>
                      {{/if}}
                      {{#if (or group2Title group2Item1Name group2Item2Name group2Item3Name group2Item4Name group2Item5Name)}}
                      <div class="submenu-group">
                        {{#if group2Title}}<div class="submenu-group-title">{{group2Title}}</div>{{/if}}
                        {{#if group2Item1Name}}<a class="submenu-item" href="{{group2Item1Link.value}}">{{group2Item1Name}}</a>{{/if}}
                        {{#if group2Item2Name}}<a class="submenu-item" href="{{group2Item2Link.value}}">{{group2Item2Name}}</a>{{/if}}
                        {{#if group2Item3Name}}<a class="submenu-item" href="{{group2Item3Link.value}}">{{group2Item3Name}}</a>{{/if}}
                        {{#if group2Item4Name}}<a class="submenu-item" href="{{group2Item4Link.value}}">{{group2Item4Name}}</a>{{/if}}
                        {{#if group2Item5Name}}<a class="submenu-item" href="{{group2Item5Link.value}}">{{group2Item5Name}}</a>{{/if}}
                      </div>
                      {{/if}}
                      {{#if (or group3Title group3Item1Name group3Item2Name group3Item3Name group3Item4Name group3Item5Name)}}
                      <div class="submenu-group">
                        {{#if group3Title}}<div class="submenu-group-title">{{group3Title}}</div>{{/if}}
                        {{#if group3Item1Name}}<a class="submenu-item" href="{{group3Item1Link.value}}">{{group3Item1Name}}</a>{{/if}}
                        {{#if group3Item2Name}}<a class="submenu-item" href="{{group3Item2Link.value}}">{{group3Item2Name}}</a>{{/if}}
                        {{#if group3Item3Name}}<a class="submenu-item" href="{{group3Item3Link.value}}">{{group3Item3Name}}</a>{{/if}}
                        {{#if group3Item4Name}}<a class="submenu-item" href="{{group3Item4Link.value}}">{{group3Item4Name}}</a>{{/if}}
                        {{#if group3Item5Name}}<a class="submenu-item" href="{{group3Item5Link.value}}">{{group3Item5Name}}</a>{{/if}}
                      </div>
                      {{/if}}
                    </div>
                    {{/if}}
                  </div>
                  <div class="submenu-right">
                    {{#if (and (eq ../property.logoAlign 'right') ../property.logoImage)}}
                    <div class="submenu-logo-placeholder" style="width: {{../property.logoWidth}}px; margin-right: 20px;"></div>
                    {{/if}}
                    {{#if (eq ../property.menuAlign 'right')}}
                    <div class="submenu-groups-wrapper">
                      {{#if (or group1Title group1Item1Name group1Item2Name group1Item3Name group1Item4Name group1Item5Name)}}
                      <div class="submenu-group">
                        {{#if group1Title}}<div class="submenu-group-title">{{group1Title}}</div>{{/if}}
                        {{#if group1Item1Name}}<a class="submenu-item" href="{{group1Item1Link.value}}">{{group1Item1Name}}</a>{{/if}}
                        {{#if group1Item2Name}}<a class="submenu-item" href="{{group1Item2Link.value}}">{{group1Item2Name}}</a>{{/if}}
                        {{#if group1Item3Name}}<a class="submenu-item" href="{{group1Item3Link.value}}">{{group1Item3Name}}</a>{{/if}}
                        {{#if group1Item4Name}}<a class="submenu-item" href="{{group1Item4Link.value}}">{{group1Item4Name}}</a>{{/if}}
                        {{#if group1Item5Name}}<a class="submenu-item" href="{{group1Item5Link.value}}">{{group1Item5Name}}</a>{{/if}}
                      </div>
                      {{/if}}
                      {{#if (or group2Title group2Item1Name group2Item2Name group2Item3Name group2Item4Name group2Item5Name)}}
                      <div class="submenu-group">
                        {{#if group2Title}}<div class="submenu-group-title">{{group2Title}}</div>{{/if}}
                        {{#if group2Item1Name}}<a class="submenu-item" href="{{group2Item1Link.value}}">{{group2Item1Name}}</a>{{/if}}
                        {{#if group2Item2Name}}<a class="submenu-item" href="{{group2Item2Link.value}}">{{group2Item2Name}}</a>{{/if}}
                        {{#if group2Item3Name}}<a class="submenu-item" href="{{group2Item3Link.value}}">{{group2Item3Name}}</a>{{/if}}
                        {{#if group2Item4Name}}<a class="submenu-item" href="{{group2Item4Link.value}}">{{group2Item4Name}}</a>{{/if}}
                        {{#if group2Item5Name}}<a class="submenu-item" href="{{group2Item5Link.value}}">{{group2Item5Name}}</a>{{/if}}
                      </div>
                      {{/if}}
                      {{#if (or group3Title group3Item1Name group3Item2Name group3Item3Name group3Item4Name group3Item5Name)}}
                      <div class="submenu-group">
                        {{#if group3Title}}<div class="submenu-group-title">{{group3Title}}</div>{{/if}}
                        {{#if group3Item1Name}}<a class="submenu-item" href="{{group3Item1Link.value}}">{{group3Item1Name}}</a>{{/if}}
                        {{#if group3Item2Name}}<a class="submenu-item" href="{{group3Item2Link.value}}">{{group3Item2Name}}</a>{{/if}}
                        {{#if group3Item3Name}}<a class="submenu-item" href="{{group3Item3Link.value}}">{{group3Item3Name}}</a>{{/if}}
                        {{#if group3Item4Name}}<a class="submenu-item" href="{{group3Item4Link.value}}">{{group3Item4Name}}</a>{{/if}}
                        {{#if group3Item5Name}}<a class="submenu-item" href="{{group3Item5Link.value}}">{{group3Item5Name}}</a>{{/if}}
                      </div>
                      {{/if}}
                    </div>
                    {{/if}}
                  </div>
                </div>
              </div>
            </div>
            {{else}}
            <a href="{{link.value}}">{{name}}</a>
            {{/if}}
          {{/each}}
        </nav>
        {{/if}}

        {{#if (and (eq property.utilityMenuAlign 'center') (gt (size property.utilityMenuItems) 0))}}
        <nav class="utility-menu">
          {{#each property.utilityMenuItems}}
          <div class="utility-item">
            {{#if (eq ../property.utilityIconPosition 'left')}}
              {{#if iconSvg}}{{{iconSvg}}}{{/if}}
              <a href="{{link.value}}">{{name}}</a>
            {{else}}
              <a href="{{link.value}}">{{name}}</a>
              {{#if iconSvg}}{{{iconSvg}}}{{/if}}
            {{/if}}
          </div>
          {{/each}}
        </nav>
        {{/if}}

        {{#if (and (eq property.languageButtonAlign 'center') (gt (size property.languageButtons) 0))}}
        <div class="language-buttons">
          {{#each property.languageButtons}}
          <a href="{{link.value}}" class="language-btn {{#if isActive}}active{{/if}}">{{text}}</a>
          {{/each}}
        </div>
        {{/if}}
      </div>

      <div class="header-right">
        <div class="header-right-content">
          {{#if (eq property.logoAlign 'right')}}
          <div class="logo">
            {{#if property.logoImage}}
            <a href="{{property.logoLink.value}}">
              <img src="{{property.logoImage}}" alt="Logo" />
            </a>
            {{/if}}
          </div>
          {{/if}}

          {{#if (eq property.menuAlign 'right')}}
          <nav class="nav-desktop">
            {{#each property.menuItems}}
              {{#if hasSubmenu}}
              <div class="menu-item-wrapper">
                <a href="{{link.value}}">{{name}}</a>
                <div class="submenu">
                  <div class="submenu-content">
                    <div class="submenu-left">
                      {{#if (eq ../property.menuAlign 'left')}}
                      <div class="submenu-groups-wrapper">
                        {{#if (or group1Title group1Item1Name group1Item2Name group1Item3Name group1Item4Name group1Item5Name)}}
                        <div class="submenu-group">
                          {{#if group1Title}}<div class="submenu-group-title">{{group1Title}}</div>{{/if}}
                          {{#if group1Item1Name}}<a class="submenu-item" href="{{group1Item1Link.value}}">{{group1Item1Name}}</a>{{/if}}
                          {{#if group1Item2Name}}<a class="submenu-item" href="{{group1Item2Link.value}}">{{group1Item2Name}}</a>{{/if}}
                          {{#if group1Item3Name}}<a class="submenu-item" href="{{group1Item3Link.value}}">{{group1Item3Name}}</a>{{/if}}
                          {{#if group1Item4Name}}<a class="submenu-item" href="{{group1Item4Link.value}}">{{group1Item4Name}}</a>{{/if}}
                          {{#if group1Item5Name}}<a class="submenu-item" href="{{group1Item5Link.value}}">{{group1Item5Name}}</a>{{/if}}
                        </div>
                        {{/if}}
                        {{#if (or group2Title group2Item1Name group2Item2Name group2Item3Name group2Item4Name group2Item5Name)}}
                        <div class="submenu-group">
                          {{#if group2Title}}<div class="submenu-group-title">{{group2Title}}</div>{{/if}}
                          {{#if group2Item1Name}}<a class="submenu-item" href="{{group2Item1Link.value}}">{{group2Item1Name}}</a>{{/if}}
                          {{#if group2Item2Name}}<a class="submenu-item" href="{{group2Item2Link.value}}">{{group2Item2Name}}</a>{{/if}}
                          {{#if group2Item3Name}}<a class="submenu-item" href="{{group2Item3Link.value}}">{{group2Item3Name}}</a>{{/if}}
                          {{#if group2Item4Name}}<a class="submenu-item" href="{{group2Item4Link.value}}">{{group2Item4Name}}</a>{{/if}}
                          {{#if group2Item5Name}}<a class="submenu-item" href="{{group2Item5Link.value}}">{{group2Item5Name}}</a>{{/if}}
                        </div>
                        {{/if}}
                        {{#if (or group3Title group3Item1Name group3Item2Name group3Item3Name group3Item4Name group3Item5Name)}}
                        <div class="submenu-group">
                          {{#if group3Title}}<div class="submenu-group-title">{{group3Title}}</div>{{/if}}
                          {{#if group3Item1Name}}<a class="submenu-item" href="{{group3Item1Link.value}}">{{group3Item1Name}}</a>{{/if}}
                          {{#if group3Item2Name}}<a class="submenu-item" href="{{group3Item2Link.value}}">{{group3Item2Name}}</a>{{/if}}
                          {{#if group3Item3Name}}<a class="submenu-item" href="{{group3Item3Link.value}}">{{group3Item3Name}}</a>{{/if}}
                          {{#if group3Item4Name}}<a class="submenu-item" href="{{group3Item4Link.value}}">{{group3Item4Name}}</a>{{/if}}
                          {{#if group3Item5Name}}<a class="submenu-item" href="{{group3Item5Link.value}}">{{group3Item5Name}}</a>{{/if}}
                        </div>
                        {{/if}}
                      </div>
                      {{/if}}
                    </div>
                    <div class="submenu-center">
                      {{#if (eq ../property.menuAlign 'center')}}
                      <div class="submenu-groups-wrapper">
                        {{#if (or group1Title group1Item1Name group1Item2Name group1Item3Name group1Item4Name group1Item5Name)}}
                        <div class="submenu-group">
                          {{#if group1Title}}<div class="submenu-group-title">{{group1Title}}</div>{{/if}}
                          {{#if group1Item1Name}}<a class="submenu-item" href="{{group1Item1Link.value}}">{{group1Item1Name}}</a>{{/if}}
                          {{#if group1Item2Name}}<a class="submenu-item" href="{{group1Item2Link.value}}">{{group1Item2Name}}</a>{{/if}}
                          {{#if group1Item3Name}}<a class="submenu-item" href="{{group1Item3Link.value}}">{{group1Item3Name}}</a>{{/if}}
                          {{#if group1Item4Name}}<a class="submenu-item" href="{{group1Item4Link.value}}">{{group1Item4Name}}</a>{{/if}}
                          {{#if group1Item5Name}}<a class="submenu-item" href="{{group1Item5Link.value}}">{{group1Item5Name}}</a>{{/if}}
                        </div>
                        {{/if}}
                        {{#if (or group2Title group2Item1Name group2Item2Name group2Item3Name group2Item4Name group2Item5Name)}}
                        <div class="submenu-group">
                          {{#if group2Title}}<div class="submenu-group-title">{{group2Title}}</div>{{/if}}
                          {{#if group2Item1Name}}<a class="submenu-item" href="{{group2Item1Link.value}}">{{group2Item1Name}}</a>{{/if}}
                          {{#if group2Item2Name}}<a class="submenu-item" href="{{group2Item2Link.value}}">{{group2Item2Name}}</a>{{/if}}
                          {{#if group2Item3Name}}<a class="submenu-item" href="{{group2Item3Link.value}}">{{group2Item3Name}}</a>{{/if}}
                          {{#if group2Item4Name}}<a class="submenu-item" href="{{group2Item4Link.value}}">{{group2Item4Name}}</a>{{/if}}
                          {{#if group2Item5Name}}<a class="submenu-item" href="{{group2Item5Link.value}}">{{group2Item5Name}}</a>{{/if}}
                        </div>
                        {{/if}}
                        {{#if (or group3Title group3Item1Name group3Item2Name group3Item3Name group3Item4Name group3Item5Name)}}
                        <div class="submenu-group">
                          {{#if group3Title}}<div class="submenu-group-title">{{group3Title}}</div>{{/if}}
                          {{#if group3Item1Name}}<a class="submenu-item" href="{{group3Item1Link.value}}">{{group3Item1Name}}</a>{{/if}}
                          {{#if group3Item2Name}}<a class="submenu-item" href="{{group3Item2Link.value}}">{{group3Item2Name}}</a>{{/if}}
                          {{#if group3Item3Name}}<a class="submenu-item" href="{{group3Item3Link.value}}">{{group3Item3Name}}</a>{{/if}}
                          {{#if group3Item4Name}}<a class="submenu-item" href="{{group3Item4Link.value}}">{{group3Item4Name}}</a>{{/if}}
                          {{#if group3Item5Name}}<a class="submenu-item" href="{{group3Item5Link.value}}">{{group3Item5Name}}</a>{{/if}}
                        </div>
                        {{/if}}
                      </div>
                      {{/if}}
                    </div>
                    <div class="submenu-right">
                      {{#if (eq ../property.menuAlign 'right')}}
                      <div class="submenu-groups-wrapper">
                        {{#if (or group1Title group1Item1Name group1Item2Name group1Item3Name group1Item4Name group1Item5Name)}}
                        <div class="submenu-group">
                          {{#if group1Title}}<div class="submenu-group-title">{{group1Title}}</div>{{/if}}
                          {{#if group1Item1Name}}<a class="submenu-item" href="{{group1Item1Link.value}}">{{group1Item1Name}}</a>{{/if}}
                          {{#if group1Item2Name}}<a class="submenu-item" href="{{group1Item2Link.value}}">{{group1Item2Name}}</a>{{/if}}
                          {{#if group1Item3Name}}<a class="submenu-item" href="{{group1Item3Link.value}}">{{group1Item3Name}}</a>{{/if}}
                          {{#if group1Item4Name}}<a class="submenu-item" href="{{group1Item4Link.value}}">{{group1Item4Name}}</a>{{/if}}
                          {{#if group1Item5Name}}<a class="submenu-item" href="{{group1Item5Link.value}}">{{group1Item5Name}}</a>{{/if}}
                        </div>
                        {{/if}}
                        {{#if (or group2Title group2Item1Name group2Item2Name group2Item3Name group2Item4Name group2Item5Name)}}
                        <div class="submenu-group">
                          {{#if group2Title}}<div class="submenu-group-title">{{group2Title}}</div>{{/if}}
                          {{#if group2Item1Name}}<a class="submenu-item" href="{{group2Item1Link.value}}">{{group2Item1Name}}</a>{{/if}}
                          {{#if group2Item2Name}}<a class="submenu-item" href="{{group2Item2Link.value}}">{{group2Item2Name}}</a>{{/if}}
                          {{#if group2Item3Name}}<a class="submenu-item" href="{{group2Item3Link.value}}">{{group2Item3Name}}</a>{{/if}}
                          {{#if group2Item4Name}}<a class="submenu-item" href="{{group2Item4Link.value}}">{{group2Item4Name}}</a>{{/if}}
                          {{#if group2Item5Name}}<a class="submenu-item" href="{{group2Item5Link.value}}">{{group2Item5Name}}</a>{{/if}}
                        </div>
                        {{/if}}
                        {{#if (or group3Title group3Item1Name group3Item2Name group3Item3Name group3Item4Name group3Item5Name)}}
                        <div class="submenu-group">
                          {{#if group3Title}}<div class="submenu-group-title">{{group3Title}}</div>{{/if}}
                          {{#if group3Item1Name}}<a class="submenu-item" href="{{group3Item1Link.value}}">{{group3Item1Name}}</a>{{/if}}
                          {{#if group3Item2Name}}<a class="submenu-item" href="{{group3Item2Link.value}}">{{group3Item2Name}}</a>{{/if}}
                          {{#if group3Item3Name}}<a class="submenu-item" href="{{group3Item3Link.value}}">{{group3Item3Name}}</a>{{/if}}
                          {{#if group3Item4Name}}<a class="submenu-item" href="{{group3Item4Link.value}}">{{group3Item4Name}}</a>{{/if}}
                          {{#if group3Item5Name}}<a class="submenu-item" href="{{group3Item5Link.value}}">{{group3Item5Name}}</a>{{/if}}
                        </div>
                        {{/if}}
                      </div>
                      {{/if}}
                    </div>
                  </div>
                </div>
              </div>
              {{else}}
              <a href="{{link.value}}">{{name}}</a>
              {{/if}}
            {{/each}}
          </nav>
          {{/if}}

          {{#if (and (eq property.utilityMenuAlign 'right') (gt (size property.utilityMenuItems) 0))}}
          <nav class="utility-menu">
            {{#each property.utilityMenuItems}}
            <div class="utility-item">
              {{#if (eq ../property.utilityIconPosition 'left')}}
                {{#if iconSvg}}{{{iconSvg}}}{{/if}}
                <a href="{{link.value}}">{{name}}</a>
              {{else}}
                <a href="{{link.value}}">{{name}}</a>
                {{#if iconSvg}}{{{iconSvg}}}{{/if}}
              {{/if}}
            </div>
            {{/each}}
          </nav>
          {{/if}}

          {{#if (and (eq property.languageButtonAlign 'right') (gt (size property.languageButtons) 0))}}
          <div class="language-buttons">
            {{#each property.languageButtons}}
            <a href="{{link.value}}" class="language-btn {{#if isActive}}active{{/if}}">{{text}}</a>
            {{/each}}
          </div>
          {{/if}}
        </div>

        <button class="hamburger">
          <svg viewBox="0 0 24 24" fill="none" stroke-width="2">
            <line x1="3" y1="6" x2="21" y2="6"/>
            <line x1="3" y1="12" x2="21" y2="12"/>
            <line x1="3" y1="18" x2="21" y2="18"/>
          </svg>
        </button>
      </div>
    </div>
  </header>

  <div class="overlay"></div>

  <div class="nav-mobile">
    <div class="mobile-header">
      <button class="close-btn">
        <svg viewBox="0 0 24 24" fill="none" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"/>
          <line x1="6" y1="6" x2="18" y2="18"/>
        </svg>
      </button>
    </div>
    <div class="mobile-menu">
      {{#each property.menuItems}}
      <a href="{{link.value}}">{{name}}</a>
      {{#if hasSubmenu}}
        {{#if (or group1Title group1Item1Name group1Item2Name group1Item3Name group1Item4Name group1Item5Name)}}
          {{#if group1Title}}<div style="padding-left: 20px; font-weight: bold; font-size: 0.9em; color: #666; margin-top: 8px;">{{group1Title}}</div>{{/if}}
          {{#if group1Item1Name}}<a href="{{group1Item1Link.value}}" style="padding-left: 30px; font-size: 0.9em;">{{group1Item1Name}}</a>{{/if}}
          {{#if group1Item2Name}}<a href="{{group1Item2Link.value}}" style="padding-left: 30px; font-size: 0.9em;">{{group1Item2Name}}</a>{{/if}}
          {{#if group1Item3Name}}<a href="{{group1Item3Link.value}}" style="padding-left: 30px; font-size: 0.9em;">{{group1Item3Name}}</a>{{/if}}
          {{#if group1Item4Name}}<a href="{{group1Item4Link.value}}" style="padding-left: 30px; font-size: 0.9em;">{{group1Item4Name}}</a>{{/if}}
          {{#if group1Item5Name}}<a href="{{group1Item5Link.value}}" style="padding-left: 30px; font-size: 0.9em;">{{group1Item5Name}}</a>{{/if}}
        {{/if}}
        {{#if (or group2Title group2Item1Name group2Item2Name group2Item3Name group2Item4Name group2Item5Name)}}
          {{#if group2Title}}<div style="padding-left: 20px; font-weight: bold; font-size: 0.9em; color: #666; margin-top: 8px;">{{group2Title}}</div>{{/if}}
          {{#if group2Item1Name}}<a href="{{group2Item1Link.value}}" style="padding-left: 30px; font-size: 0.9em;">{{group2Item1Name}}</a>{{/if}}
          {{#if group2Item2Name}}<a href="{{group2Item2Link.value}}" style="padding-left: 30px; font-size: 0.9em;">{{group2Item2Name}}</a>{{/if}}
          {{#if group2Item3Name}}<a href="{{group2Item3Link.value}}" style="padding-left: 30px; font-size: 0.9em;">{{group2Item3Name}}</a>{{/if}}
          {{#if group2Item4Name}}<a href="{{group2Item4Link.value}}" style="padding-left: 30px; font-size: 0.9em;">{{group2Item4Name}}</a>{{/if}}
          {{#if group2Item5Name}}<a href="{{group2Item5Link.value}}" style="padding-left: 30px; font-size: 0.9em;">{{group2Item5Name}}</a>{{/if}}
        {{/if}}
        {{#if (or group3Title group3Item1Name group3Item2Name group3Item3Name group3Item4Name group3Item5Name)}}
          {{#if group3Title}}<div style="padding-left: 20px; font-weight: bold; font-size: 0.9em; color: #666; margin-top: 8px;">{{group3Title}}</div>{{/if}}
          {{#if group3Item1Name}}<a href="{{group3Item1Link.value}}" style="padding-left: 30px; font-size: 0.9em;">{{group3Item1Name}}</a>{{/if}}
          {{#if group3Item2Name}}<a href="{{group3Item2Link.value}}" style="padding-left: 30px; font-size: 0.9em;">{{group3Item2Name}}</a>{{/if}}
          {{#if group3Item3Name}}<a href="{{group3Item3Link.value}}" style="padding-left: 30px; font-size: 0.9em;">{{group3Item3Name}}</a>{{/if}}
          {{#if group3Item4Name}}<a href="{{group3Item4Link.value}}" style="padding-left: 30px; font-size: 0.9em;">{{group3Item4Name}}</a>{{/if}}
          {{#if group3Item5Name}}<a href="{{group3Item5Link.value}}" style="padding-left: 30px; font-size: 0.9em;">{{group3Item5Name}}</a>{{/if}}
        {{/if}}
      {{/if}}
      {{/each}}
    </div>
  </div>
</template>

<script>
  const container = bm.container;
  const context = bm.context;

  function handleScroll() {
    const header = container.querySelector('.global-header');
    if (!header) return;

    if (!context.property.enableScrollStyle) {
      header.classList.remove('scrolled');
      return;
    }

    if (context.property.previewScrolled !== false) {
      header.classList.add('scrolled');
      return;
    }

    if (window.scrollY > context.property.scrollThreshold) {
      header.classList.add('scrolled');
    } else {
      header.classList.remove('scrolled');
    }
  }

  container.addEventListener('click', (e) => {
    const navMobile = container.querySelector('.nav-mobile');
    const overlay = container.querySelector('.overlay');

    if (e.target.closest('.hamburger')) {
      navMobile.classList.add('active');
      overlay.classList.add('active');
      document.body.style.overflow = 'hidden';
    }

    if (e.target.closest('.close-btn') || e.target.matches('.overlay')) {
      navMobile.classList.remove('active');
      overlay.classList.remove('active');
      document.body.style.overflow = '';
    }

    if (e.target.matches('.mobile-menu a')) {
      navMobile.classList.remove('active');
      overlay.classList.remove('active');
      document.body.style.overflow = '';
    }

    // 빈 링크 클릭 방지
    const link = e.target.closest('a');
    if (link) {
      const href = link.getAttribute('href');
      if (!href || href === '' || href === '#' || href === 'null' || href === 'undefined') {
        e.preventDefault();
        e.stopPropagation();
      }
    }
  }, true);

  if (context.property.enableScrollStyle) {
    window.addEventListener('scroll', handleScroll, { passive: true });
    handleScroll();
  }

  let isApplying = false;
  bm.onContextChange = () => {
    // 무한 루프 방지: apply 중에는 다시 호출하지 않음
    if (isApplying) {
      return;
    }

    isApplying = true;

    // 템플릿 강제 재렌더링
    bm.apply();

    // 재렌더링 완료 후 스크롤 처리 및 플래그 리셋
    setTimeout(() => {
      if (context.property.enableScrollStyle) {
        handleScroll();
      }
      isApplying = false;
    }, 50);
  };

  bm.onDestroy = () => {
    window.removeEventListener('scroll', handleScroll);
    document.body.style.overflow = '';
  };
</script>
