<style>
  .global-header {
    width: 100%;
    height: {{property.headerHeight}}px;
    {{#if (eq property.headerBgType 'gradient')}}
    background: linear-gradient({{property.headerGradientAngle}}deg, {{property.headerGradientStart}}, {{property.headerGradientEnd}});
    {{else}}
    background: {{property.headerBg}};
    {{/if}}
    {{#if (gt property.headerShadow 0)}}
    box-shadow: 0 2px {{property.headerShadow}}px {{property.headerShadowColor}};
    {{/if}}
    {{#if (gt property.headerBlur 0)}}
    backdrop-filter: blur({{property.headerBlur}}px);
    -webkit-backdrop-filter: blur({{property.headerBlur}}px);
    {{/if}}
    {{#if (gt property.headerBorder 0)}}
    border-bottom: {{property.headerBorder}}px solid {{property.headerBorderColor}};
    {{/if}}
    transition: all 0.3s ease;
    z-index: 1000;

    {{#if property.isOverlay}}
    position: {{#if property.isSticky}}fixed{{else}}absolute{{/if}};
    top: 0;
    left: 0;
    {{else}}
      {{#if property.isSticky}}
      position: sticky;
      top: 0;
      {{else}}
      position: relative;
      {{/if}}
    {{/if}}
  }

  {{#if property.enableScrollStyle}}
  .global-header.scrolled {
    {{#if (eq property.scrollBgType 'gradient')}}
    background: linear-gradient({{property.scrollGradientAngle}}deg, {{property.scrollGradientStart}}, {{property.scrollGradientEnd}}) !important;
    {{else}}
    background: {{property.scrollBg}} !important;
    {{/if}}
    {{#if (gt property.scrollShadow 0)}}
    box-shadow: 0 2px {{property.scrollShadow}}px {{property.scrollShadowColor}} !important;
    {{else}}
    box-shadow: none !important;
    {{/if}}
    {{#if (gt property.scrollBlur 0)}}
    backdrop-filter: blur({{property.scrollBlur}}px) !important;
    -webkit-backdrop-filter: blur({{property.scrollBlur}}px) !important;
    {{/if}}
    {{#if (gt property.scrollBorder 0)}}
    border-bottom: {{property.scrollBorder}}px solid {{property.headerBorderColor}} !important;
    {{else}}
    border-bottom: none !important;
    {{/if}}
  }
  {{/if}}

  .header-container {
    max-width: 100%;
    height: 100%;
    padding: 0 {{property.headerPadding}}px;
    display: grid;
    grid-template-columns: 1fr auto 1fr;
    align-items: center;
    gap: 20px;
  }

  .header-left {
    display: flex;
    {{#if (eq property.logoAlign 'left')}}
    justify-content: flex-start;
    {{else if (eq property.logoAlign 'center')}}
    justify-content: center;
    {{else}}
    justify-content: flex-end;
    {{/if}}
  }

  .header-center {
    display: flex;
    justify-content: center;
  }

  .header-right {
    display: flex;
    {{#if (eq property.menuAlign 'left')}}
    justify-content: flex-start;
    {{else if (eq property.menuAlign 'center')}}
    justify-content: center;
    {{else}}
    justify-content: flex-end;
    {{/if}}
  }

  .logo {
    display: flex;
    align-items: center;
    margin: {{property.logoMarginY}}px {{property.logoMarginX}}px;
  }

  .logo a {
    display: block;
    line-height: 0;
  }

  {{#if property.logoImage}}
  .logo img {
    width: {{property.logoWidth}}px;
    height: auto;
  }
  {{/if}}

  .nav-desktop {
    display: flex;
    gap: {{property.menuGapDesktop}}px;
    align-items: center;
    margin: {{property.menuMarginY}}px {{property.menuMarginX}}px;
  }

  .nav-desktop a {
    color: {{property.menuColorDesktop}};
    font-size: {{property.menuSizeDesktop}}px;
    text-decoration: none;
    transition: opacity 0.2s;
    white-space: nowrap;
  }

  .nav-desktop a:hover {
    opacity: 0.7;
  }

  .hamburger {
    display: none;
    background: none;
    border: none;
    cursor: pointer;
    padding: 8px;
  }

  .hamburger svg {
    width: 24px;
    height: 24px;
    stroke: {{property.menuColorDesktop}};
  }

  .nav-mobile {
    position: fixed;
    top: 0;
    right: -100%;
    width: 280px;
    height: 100vh;
    background: #fff;
    box-shadow: -2px 0 10px rgba(0,0,0,0.1);
    transition: right 0.3s;
    z-index: 2000;
    overflow-y: auto;
  }

  .nav-mobile.active {
    right: 0;
  }

  .mobile-header {
    padding: 20px;
    display: flex;
    justify-content: flex-end;
    border-bottom: 1px solid #eee;
  }

  .close-btn {
    background: none;
    border: none;
    cursor: pointer;
    padding: 8px;
  }

  .close-btn svg {
    width: 24px;
    height: 24px;
    stroke: {{property.menuColorMobile}};
  }

  .mobile-menu {
    padding: 20px;
  }

  .mobile-menu a {
    display: block;
    color: {{property.menuColorMobile}};
    font-size: {{property.menuSizeMobile}}px;
    text-decoration: none;
    padding: 15px 0;
    border-bottom: 1px solid #f5f5f5;
  }

  .overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100vh;
    background: rgba(0,0,0,0.5);
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s;
    z-index: 1999;
  }

  .overlay.active {
    opacity: 1;
    visibility: visible;
  }

  @media (max-width: 768px) {
    .header-container {
      padding: 0 20px;
      grid-template-columns: 1fr auto;
    }

    .header-center {
      display: none;
    }

    .nav-desktop {
      display: none;
    }

    .hamburger {
      display: block;
    }
  }
</style>

<template>
  <header class="global-header">
    <div class="header-container">
      <div class="header-left">
        {{#if (eq property.logoAlign 'left')}}
        <div class="logo">
          {{#if property.logoImage}}
          <a href="{{property.logoLink.value}}">
            <img src="{{property.logoImage}}" alt="Logo" />
          </a>
          {{/if}}
        </div>
        {{/if}}

        {{#if (eq property.menuAlign 'left')}}
        <nav class="nav-desktop">
          {{#each property.menuItems}}
          <a href="{{link.value}}">{{name}}</a>
          {{/each}}
        </nav>
        {{/if}}
      </div>

      <div class="header-center">
        {{#if (eq property.logoAlign 'center')}}
        <div class="logo">
          {{#if property.logoImage}}
          <a href="{{property.logoLink.value}}">
            <img src="{{property.logoImage}}" alt="Logo" />
          </a>
          {{/if}}
        </div>
        {{/if}}

        {{#if (eq property.menuAlign 'center')}}
        <nav class="nav-desktop">
          {{#each property.menuItems}}
          <a href="{{link.value}}">{{name}}</a>
          {{/each}}
        </nav>
        {{/if}}
      </div>

      <div class="header-right">
        {{#if (eq property.logoAlign 'right')}}
        <div class="logo">
          {{#if property.logoImage}}
          <a href="{{property.logoLink.value}}">
            <img src="{{property.logoImage}}" alt="Logo" />
          </a>
          {{/if}}
        </div>
        {{/if}}

        {{#if (eq property.menuAlign 'right')}}
        <nav class="nav-desktop">
          {{#each property.menuItems}}
          <a href="{{link.value}}">{{name}}</a>
          {{/each}}
        </nav>
        {{/if}}

        <button class="hamburger">
          <svg viewBox="0 0 24 24" fill="none" stroke-width="2">
            <line x1="3" y1="6" x2="21" y2="6"/>
            <line x1="3" y1="12" x2="21" y2="12"/>
            <line x1="3" y1="18" x2="21" y2="18"/>
          </svg>
        </button>
      </div>
    </div>
  </header>

  <div class="overlay"></div>

  <div class="nav-mobile">
    <div class="mobile-header">
      <button class="close-btn">
        <svg viewBox="0 0 24 24" fill="none" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"/>
          <line x1="6" y1="6" x2="18" y2="18"/>
        </svg>
      </button>
    </div>
    <div class="mobile-menu">
      {{#each property.menuItems}}
      <a href="{{link.value}}">{{name}}</a>
      {{/each}}
    </div>
  </div>
</template>

<script>
  const container = bm.container;
  const context = bm.context;
  const header = container.querySelector('.global-header');
  const navMobile = container.querySelector('.nav-mobile');
  const overlay = container.querySelector('.overlay');

  function handleScroll() {
    if (!context.property.enableScrollStyle) return;

    // 에디터 프리뷰 모드
    if (context.property.previewScrolled) {
      header.classList.add('scrolled');
      return;
    }

    // 실제 웹사이트
    if (window.scrollY > context.property.scrollThreshold) {
      header.classList.add('scrolled');
    } else {
      header.classList.remove('scrolled');
    }
  }

  container.addEventListener('click', (e) => {
    if (e.target.closest('.hamburger')) {
      navMobile.classList.add('active');
      overlay.classList.add('active');
      document.body.style.overflow = 'hidden';
    }

    if (e.target.closest('.close-btn') || e.target.matches('.overlay')) {
      navMobile.classList.remove('active');
      overlay.classList.remove('active');
      document.body.style.overflow = '';
    }

    if (e.target.matches('.mobile-menu a')) {
      navMobile.classList.remove('active');
      overlay.classList.remove('active');
      document.body.style.overflow = '';
    }
  }, true);

  if (context.property.enableScrollStyle) {
    window.addEventListener('scroll', handleScroll, { passive: true });
    handleScroll();
  }

  bm.onContextChange = () => {
    handleScroll();
  };

  bm.onDestroy = () => {
    window.removeEventListener('scroll', handleScroll);
    document.body.style.overflow = '';
  };
</script>
